# 模式切换功能测试指南

## 测试页面访问

开发服务器启动后，访问以下URL进行测试：

```
http://localhost:5173/mode-switcher-test
```

## 功能测试清单

### 1. 默认访客模式测试

**测试步骤：**
1. 清除浏览器LocalStorage（可以使用测试页面的"清除LocalStorage"按钮）
2. 刷新页面
3. 验证显示"访客模式"

**预期结果：**
- ✅ 页面显示"访客模式"
- ✅ ModeIndicator显示眼睛图标和"访客模式"文字
- ✅ 认证状态显示"未认证"
- ✅ LocalStorage中`pkw_mode`为空或为`visitor`

### 2. 模式切换弹窗测试

**测试步骤：**
1. 点击页面顶部的ModeIndicator
2. 验证弹窗打开

**预期结果：**
- ✅ 弹窗正确打开
- ✅ 显示两个模式卡片：访客模式和拥有者模式
- ✅ 当前模式（访客模式）显示"当前模式"标识
- ✅ 每个卡片显示图标、标题、描述和功能列表

### 3. 切换到拥有者模式（无Token）

**测试步骤：**
1. 在弹窗中点击"拥有者模式"卡片
2. 验证显示Token输入表单

**预期结果：**
- ✅ 弹窗切换到Token输入表单
- ✅ 显示"输入 GitHub Token"标题
- ✅ 显示密码类型的输入框
- ✅ 显示安全提示："Token 将被加密存储在本地"
- ✅ 显示"取消"和"验证并切换"按钮

### 4. Token验证测试

**测试步骤：**
1. 输入无效的Token（如"invalid_token"）
2. 点击"验证并切换"
3. 验证错误提示

**预期结果：**
- ✅ 显示错误消息
- ✅ 输入框显示红色边框
- ✅ 保持在Token输入界面
- ✅ 可以重新输入

**测试步骤（有效Token）：**
1. 输入有效的GitHub Token
2. 点击"验证并切换"
3. 验证成功切换

**预期结果：**
- ✅ 显示"验证中..."状态
- ✅ 验证成功后弹窗关闭
- ✅ 显示Toast通知："已切换到拥有者模式"
- ✅ ModeIndicator更新为拥有者模式
- ✅ 显示用户名和头像
- ✅ 认证状态显示"已认证"

### 5. 状态持久化测试

**测试步骤：**
1. 切换到拥有者模式（使用有效Token）
2. 刷新页面
3. 验证模式保持

**预期结果：**
- ✅ 页面刷新后仍然显示拥有者模式
- ✅ 用户信息正确显示
- ✅ LocalStorage中保存了加密的Token
- ✅ LocalStorage中`pkw_mode`为`owner`

### 6. 切换回访客模式测试

**测试步骤：**
1. 在拥有者模式下，点击ModeIndicator
2. 在弹窗中选择"访客模式"
3. 验证切换成功

**预期结果：**
- ✅ 弹窗关闭
- ✅ 显示Toast通知："已切换到访客模式"
- ✅ ModeIndicator更新为访客模式
- ✅ 认证状态显示"未认证"
- ✅ LocalStorage中`pkw_mode`更新为`visitor`
- ✅ Token仍然保存在LocalStorage中（未删除）

### 7. 再次切换到拥有者模式（有Token）

**测试步骤：**
1. 在访客模式下，点击ModeIndicator
2. 选择"拥有者模式"
3. 验证直接切换（不需要重新输入Token）

**预期结果：**
- ✅ 不显示Token输入表单
- ✅ 直接切换到拥有者模式
- ✅ 用户信息正确显示

### 8. Token过期处理测试

**测试步骤：**
1. 在LocalStorage中手动修改Token为无效值
2. 刷新页面
3. 验证自动回退

**预期结果：**
- ✅ 自动切换回访客模式
- ✅ 显示Toast通知："Token已过期，已切换到访客模式"
- ✅ LocalStorage中的Token被清除

### 9. 键盘导航测试

**测试步骤：**
1. 打开模式切换弹窗
2. 使用Tab键在卡片间导航
3. 使用Enter键选择模式
4. 使用ESC键关闭弹窗

**预期结果：**
- ✅ Tab键可以在卡片间切换焦点
- ✅ 焦点状态清晰可见
- ✅ Enter键可以选择模式
- ✅ ESC键可以关闭弹窗

### 10. 可访问性测试

**测试步骤：**
1. 使用屏幕阅读器测试
2. 验证ARIA属性

**预期结果：**
- ✅ ModeIndicator有`aria-label`
- ✅ 模式卡片有`role="option"`和`aria-selected`
- ✅ 错误消息有`role="alert"`和`aria-live`
- ✅ 表单输入有正确的label关联

## 集成测试

### 在主页测试

**测试步骤：**
1. 访问主页 `http://localhost:5173/`
2. 点击左上角的ModeIndicator
3. 执行上述所有测试

**预期结果：**
- ✅ 所有功能在主页中正常工作
- ✅ 模式切换后，编辑按钮的显示/隐藏正确更新
- ✅ 同步指示器在拥有者模式下显示

## 常见问题排查

### 问题1：弹窗不打开
- 检查ModeIndicator是否有onClick事件
- 检查控制台是否有错误
- 验证ModeSwitcherModal组件是否正确导入

### 问题2：Token验证失败
- 确保Token格式正确（以`ghp_`开头）
- 检查网络连接
- 验证Token权限（需要gist权限）

### 问题3：刷新后模式丢失
- 检查LocalStorage是否被清除
- 验证authService.initialize()是否正确执行
- 检查浏览器控制台的错误日志

### 问题4：样式显示异常
- 确保Tailwind CSS正确配置
- 检查是否有CSS冲突
- 验证组件的className是否正确

## 性能测试

### 测试指标
- 弹窗打开时间：< 100ms
- Token验证时间：< 2s
- 模式切换UI更新：< 500ms
- LocalStorage读写：< 10ms

## 浏览器兼容性测试

测试以下浏览器：
- ✅ Chrome (最新版本)
- ✅ Firefox (最新版本)
- ✅ Safari (最新版本)
- ✅ Edge (最新版本)

## 移动端测试

测试以下设备：
- ✅ iPhone (Safari)
- ✅ Android (Chrome)
- ✅ iPad (Safari)

验证：
- 触摸交互正常
- 弹窗在小屏幕上正确显示
- 输入框在移动键盘弹出时可见

## 测试完成标准

所有测试项目都通过（✅）后，模式切换功能可以认为已经准备好部署。
