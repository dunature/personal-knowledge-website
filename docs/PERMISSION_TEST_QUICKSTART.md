# 权限控制测试快速启动

## 🚀 快速开始

### 1. 启动开发服务器

```bash
cd personal-knowledge-website
npm run dev
```

### 2. 访问测试页面

打开浏览器访问：
```
http://localhost:5173/permission-test
```

### 3. 测试访客模式

**重要提示：** 测试页面现在使用 `authService` API，模式切换会立即生效，无需刷新页面。

1. 页面默认显示"🔒 访客模式"
2. 检查"实际模式"显示是否为 `visitor`
3. 点击"打开问题弹窗进行测试"
4. 验证以下内容：
   - ❌ 顶部栏没有"编辑"、"删除"按钮
   - ❌ 顶部栏没有"状态"选择器
   - ❌ 问题描述没有"编辑"按钮
   - ❌ 小问题部分没有"+ 添加小问题"按钮
   - ❌ 每个小问题没有"编辑"、"删除"按钮
   - ❌ THE END 部分没有"编辑"按钮
   - ✅ 所有内容可以正常查看

### 4. 测试拥有者模式

1. 点击"切换到拥有者模式"按钮
2. 页面立即更新显示"🔓 拥有者模式"（无需刷新）
3. 检查"实际模式"显示是否为 `owner`
4. 权限状态指示器应该全部变为绿色
5. 再次点击"打开问题弹窗进行测试"
6. 验证以下内容：
   - ✅ 顶部栏显示"编辑"、"删除"按钮
   - ✅ 顶部栏显示"状态"选择器
   - ✅ 问题描述显示"编辑"按钮
   - ✅ 小问题部分显示"+ 添加小问题"按钮
   - ✅ 每个小问题显示"编辑"、"删除"按钮
   - ✅ THE END 部分显示"编辑"按钮

### 5. 测试模式切换

1. 在拥有者模式下，点击"切换到访客模式"
2. 验证所有编辑按钮消失
3. 再次切换回拥有者模式
4. 验证所有编辑按钮重新出现

## 📊 权限状态指示器

测试页面提供实时权限状态显示：

- 🟢 绿色圆点 = 权限允许
- 🔴 红色圆点 = 权限禁止

显示的权限包括：
- 编辑权限
- 删除权限
- 添加权限

## 🎯 预期结果

### 访客模式
```
当前模式: 🔒 访客模式
编辑权限: ✗ 禁止
删除权限: ✗ 禁止
添加权限: ✗ 禁止
```

### 拥有者模式
```
当前模式: 🔓 拥有者模式
编辑权限: ✓ 允许
删除权限: ✓ 允许
添加权限: ✓ 允许
```

## 🔍 调试技巧

### 查看控制台日志

打开浏览器开发者工具（F12），在控制台中可以看到：
- 问题更新日志
- 问题删除日志
- 权限检查结果

### 检查 LocalStorage

在控制台中运行：
```javascript
// 查看当前 token
localStorage.getItem('github_token')

// 手动设置拥有者模式
localStorage.setItem('github_token', 'test-token')

// 手动设置访客模式
localStorage.removeItem('github_token')
```

## 📝 测试清单

复制以下清单进行测试：

```
访客模式测试：
[ ] 顶部栏编辑按钮隐藏
[ ] 顶部栏删除按钮隐藏
[ ] 顶部栏状态选择器隐藏
[ ] 问题描述编辑按钮隐藏
[ ] 添加小问题按钮隐藏
[ ] 小问题编辑按钮隐藏
[ ] 小问题删除按钮隐藏
[ ] THE END 编辑按钮隐藏
[ ] 所有内容可正常查看

拥有者模式测试：
[ ] 顶部栏编辑按钮显示
[ ] 顶部栏删除按钮显示
[ ] 顶部栏状态选择器显示
[ ] 问题描述编辑按钮显示
[ ] 添加小问题按钮显示
[ ] 小问题编辑按钮显示
[ ] 小问题删除按钮显示
[ ] THE END 编辑按钮显示

模式切换测试：
[ ] 访客 → 拥有者切换正常
[ ] 拥有者 → 访客切换正常
[ ] 权限状态指示器正确更新
[ ] 页面刷新后模式保持
```

## 🐛 常见问题

### Q: 切换模式后没有变化？
**A:** 
1. 检查"实际模式"显示是否已更新
2. 检查权限状态指示器颜色是否改变
3. 如果仍然没有变化，打开浏览器控制台查看是否有错误
4. 尝试手动刷新页面（F5）

### Q: 权限状态显示不正确？
**A:** 检查浏览器控制台是否有错误。清除 LocalStorage 后重试。

### Q: 测试页面无法访问？
**A:** 确保：
1. 开发服务器正在运行
2. 访问的是开发环境（`npm run dev`）
3. 路径正确：`/permission-test`

## 📚 相关文档

- [详细测试指南](./testing/PERMISSION_CONTROL_TEST.md)
- [实现总结](./PERMISSION_CONTROL_IMPLEMENTATION.md)
- [权限服务代码](../src/services/permissionService.ts)

## ✅ 测试完成

测试完成后，你应该能够确认：

1. ✅ 访客模式下所有编辑功能被正确隐藏
2. ✅ 拥有者模式下所有编辑功能正常显示
3. ✅ 模式切换功能正常工作
4. ✅ 权限状态指示器准确反映当前权限
5. ✅ 用户体验流畅，没有混淆

恭喜！权限控制功能测试通过！🎉
