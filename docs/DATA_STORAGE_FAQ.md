# 数据存储常见问题解答（FAQ）

## 📦 数据存储机制

### 数据存储在哪里？

**数据实际上存储在 GitHub Gist 中，而不是 Token 中。**

```
┌─────────────────────────────────────────┐
│         你的 GitHub 账号                 │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  Gist (ID: abc123...)           │   │
│  │  描述: Personal Knowledge Base  │   │
│  │                                 │   │
│  │  📄 resources.json              │   │
│  │  📄 questions.json              │   │
│  │  📄 metadata.json               │   │
│  └─────────────────────────────────┘   │
│           ↑                             │
│           │ 通过 Token 访问              │
│           │                             │
│  ┌────────┴────────┐                   │
│  │  Token (钥匙)    │                   │
│  └─────────────────┘                   │
└─────────────────────────────────────────┘
```

### Token 的作用是什么？

Token 就像是你家的钥匙：

- **🔑 钥匙（Token）**：用于验证你有权限访问 Gist
- **🏠 房子（Gist）**：实际存储数据的地方
- **📦 家具（数据）**：你的资源、问题、回答等内容

**重要理解：**
- Token 丢了 → 可以配新钥匙（重新生成 Token）
- 房子还在 → 你的数据（Gist）还在 GitHub 上
- 换钥匙 → 只要是同一个 GitHub 账号的 Token，都能访问同一个 Gist

## ❓ 常见问题

### Q1: 更换 Token 后，我的数据会丢失吗？

**答：不会！你的数据完全安全。**

原因：
1. **数据存储在 Gist 中**，不在 Token 中
2. **Gist ID 会保存在本地**（LocalStorage）
3. **系统会自动检测**你的 Gist 并恢复数据

### Q2: 如果 Token 过期了怎么办？

**答：重新生成一个新的 Token 即可。**

步骤：
```
1. 去 GitHub 生成新的 Token
   ↓
2. 在应用中输入新 Token
   ↓
3. 系统自动检测到你的 Gist
   ↓
4. 自动下载数据
   ↓
5. 一切恢复正常！✨
```

### Q3: 我可以在多个设备上使用同一个账号吗？

**答：可以！这正是云端存储的优势。**

场景：
```
设备 A (家里电脑)
  ↓ 配置 Token A
  ↓ 创建 Gist
  ↓ 保存数据

设备 B (公司电脑)
  ↓ 配置 Token B (同一个 GitHub 账号)
  ↓ 系统自动检测到 Gist
  ↓ 自动下载数据
  ↓ 看到和设备 A 一样的数据！
```

### Q4: 如果我清除了浏览器数据怎么办？

**答：只要你还记得 GitHub 账号，数据就能恢复。**

恢复步骤：
1. 重新配置 Token
2. 系统自动检测 Gist
3. 自动下载数据

**如果 Gist ID 也丢了：**
1. 去 GitHub 网站查看你的 Gist 列表
2. 找到描述为 "Personal Knowledge Base Data" 的 Gist
3. 复制 Gist ID
4. 在访客模式输入 Gist ID

### Q5: 同一个 GitHub 账号可以有多个 Token 吗？

**答：可以！而且它们都能访问同一个 Gist。**

```
GitHub 账号: user@example.com
  ├─ Token A (ghp_abc123...) ✅ 可以访问 Gist
  ├─ Token B (ghp_def456...) ✅ 可以访问 Gist
  └─ Token C (ghp_ghi789...) ✅ 可以访问 Gist
         ↓
    同一个 Gist (ID: xyz789...)
```

### Q6: 如果我删除了 Gist 会怎样？

**答：数据会丢失，但本地缓存还在。**

建议：
- ⚠️ 不要随意删除 Gist
- 💾 定期使用"导出数据"功能备份
- 📋 记录 Gist ID 以防万一

### Q7: 数据会自动同步吗？

**答：会！系统有多种自动同步机制。**

自动同步时机：
1. **配置 Token 后**：自动检测和同步
2. **应用启动时**：如果距离上次同步超过 5 分钟
3. **数据修改后**：3 秒防抖后自动上传
4. **网络恢复后**：自动同步离线期间的变更

## 🛡️ 数据安全保障

### 多重保护机制

1. **本地缓存**
   - 数据保存在浏览器 LocalStorage
   - 即使网络断开也能使用
   - 离线编辑，联网后自动同步

2. **Gist 版本历史**
   - GitHub 保存所有历史版本
   - 可以查看和恢复任何历史版本
   - 误操作可以回滚

3. **导出功能**
   - 随时导出 JSON 备份
   - 可以导入恢复数据
   - 完全掌控自己的数据

4. **自动检测机制**
   - Token 配置后自动检测 Gist
   - 通过描述匹配找到正确的 Gist
   - 无需手动输入 Gist ID

### 数据持久化位置

```javascript
// 1. 云端存储（主要）
GitHub Gist (ID: xyz789...)
  ├─ resources.json
  ├─ questions.json
  └─ metadata.json

// 2. 本地缓存（备份）
LocalStorage
  ├─ pkw_resources
  ├─ pkw_questions
  ├─ pkw_gist_id
  └─ pkw_github_token (加密)

// 3. 版本历史（GitHub）
Gist Commits
  ├─ Version 1 (2025-01-01)
  ├─ Version 2 (2025-01-02)
  └─ Version 3 (2025-01-03)
```

## ⚠️ 重要注意事项

### 1. Token 管理

**✅ 推荐做法：**
- 设置较长的有效期（90 天或更长）
- 保存 Token 在安全的地方（密码管理器）
- 定期检查 Token 是否过期

**❌ 避免：**
- 不要分享 Token 给他人
- 不要在公开场合展示 Token
- 不要使用短期 Token（除非测试）

### 2. Gist ID 管理

**✅ 推荐做法：**
- 记录 Gist ID（在设置页面可以看到）
- 使用"生成分享链接"功能保存链接
- 定期备份 Gist ID

**❌ 避免：**
- 不要删除 Gist（除非确定不再使用）
- 不要修改 Gist 描述（系统通过描述识别）

### 3. 数据备份

**✅ 推荐做法：**
- 定期使用"导出数据"功能
- 保存 JSON 文件到安全位置
- 重要数据多处备份

**❌ 避免：**
- 不要完全依赖云端存储
- 不要忽视本地备份的重要性

### 4. 多设备使用

**✅ 推荐做法：**
- 使用同一个 GitHub 账号
- 每个设备配置自己的 Token
- 定期同步确保数据一致

**❌ 避免：**
- 不要在多个设备同时编辑同一条数据
- 不要频繁切换设备而不同步

## 🔧 故障排除

### 场景 1：Token 过期了

**症状：**
- 无法同步数据
- 提示 "Token 无效或已过期"

**解决方案：**
```
1. 去 GitHub 生成新 Token
2. 在应用设置中更新 Token
3. 系统自动检测 Gist
4. 数据自动恢复
```

### 场景 2：找不到 Gist

**症状：**
- 配置 Token 后提示"未找到 Gist"
- 数据没有自动加载

**解决方案：**
```
1. 检查是否使用了正确的 GitHub 账号
2. 去 GitHub 网站查看 Gist 列表
3. 确认 Gist 描述是否为 "Personal Knowledge Base Data"
4. 如果找到 Gist，复制 ID 在访客模式输入
```

### 场景 3：数据冲突

**症状：**
- 显示"检测到数据冲突"对话框
- 本地和云端数据不一致

**解决方案：**
```
选择合适的策略：
1. 使用云端数据 - 如果云端是最新的
2. 使用本地数据 - 如果本地有最新修改
3. 合并数据 - 推荐，保留所有数据
```

### 场景 4：清除了浏览器数据

**症状：**
- 本地数据全部丢失
- 需要重新配置

**解决方案：**
```
1. 重新配置 Token
2. 系统自动检测 Gist
3. 自动下载云端数据
4. 如果 Gist ID 也丢了，去 GitHub 查找
```

## 💡 最佳实践

### 日常使用

1. **定期同步**
   - 让应用保持联网状态
   - 系统会自动同步
   - 不需要手动操作

2. **定期备份**
   - 每周导出一次数据
   - 保存到云盘或本地
   - 重要数据多处备份

3. **记录关键信息**
   - Gist ID
   - GitHub 账号
   - Token（安全保存）

### 多设备协作

1. **同步策略**
   - 编辑前先同步
   - 编辑后及时保存
   - 避免同时编辑

2. **冲突处理**
   - 优先选择"合并数据"
   - 检查合并结果
   - 必要时手动调整

### 安全建议

1. **Token 安全**
   - 使用密码管理器保存
   - 定期更换 Token
   - 不要分享给他人

2. **数据安全**
   - 定期备份
   - 使用版本历史
   - 重要数据加密存储

## 📚 相关文档

- [初始同步功能指南](./INITIAL_SYNC_GUIDE.md)
- [Gist 集成指南](./development/GIST_INTEGRATION.md)
- [用户设置指南](./user-guides/GIST_SETUP_GUIDE.md)
- [离线支持](./development/OFFLINE_SUPPORT.md)

## 🆘 需要帮助？

如果遇到问题：

1. 查看本文档的故障排除部分
2. 查看相关文档
3. 检查 GitHub Gist 是否正常
4. 尝试重新配置 Token
5. 使用导出/导入功能恢复数据

**记住：只要你的 GitHub 账号和 Gist 还在，数据就是安全的！**
