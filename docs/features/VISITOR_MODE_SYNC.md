# 访客模式同步功能

## 概述

访客模式现在支持从 GitHub Gist 拉取数据，让访客可以随时获取最新的知识库内容。

## 功能特性

### 访客模式（只读同步）

访客模式下，用户可以：
- ✅ 从 Gist 拉取最新数据
- ✅ 查看所有内容
- ✅ 使用搜索和筛选功能
- ❌ 不能编辑、添加或删除内容
- ❌ 不能推送数据到 Gist

### 拥有者模式（双向同步）

拥有者模式下，用户可以：
- ✅ 从 Gist 拉取最新数据
- ✅ 推送本地更改到 Gist
- ✅ 完整的编辑权限
- ✅ 双向数据同步

## 使用方法

### 访客模式同步

1. 进入设置页面
2. 在"Gist 数据管理"区域找到同步按钮
3. 点击"从 Gist 拉取数据"
4. 等待同步完成
5. 页面自动刷新显示最新数据

### 拥有者模式同步

1. 进入设置页面
2. 在"Gist 数据管理"区域找到同步按钮
3. 点击"同步数据"
4. 系统会自动进行双向同步
5. 同步完成后显示结果

## 技术实现

### 权限控制

```typescript
// 访客模式：只要有 Gist ID 就可以拉取数据
if (mode === 'visitor') {
    return gistId !== null;
}

// 拥有者模式：需要认证和 Gist ID
const isAuthenticated = authService.isAuthenticated();
return mode === 'owner' && isAuthenticated && gistId !== null;
```

### 同步流程

#### 访客模式（只读）
1. 从 Gist 获取数据
2. 验证数据格式
3. 保存到本地缓存
4. 刷新页面

#### 拥有者模式（双向）
1. 调用 syncService.syncNow()
2. 自动处理冲突
3. 双向同步数据
4. 显示同步结果

## 用户界面

### 同步按钮

- **访客模式**：蓝色按钮，显示"从 Gist 拉取数据"
- **拥有者模式**：蓝色按钮，显示"同步数据"
- **同步中**：显示加载动画和进度百分比
- **提示文本**：访客模式下显示"访客模式下只能从 Gist 拉取最新数据"

### 同步进度

同步过程中显示进度：
- 0% - 开始
- 20% - 连接 GitHub
- 40% - 验证数据
- 60% - 保存数据
- 100% - 完成

## 错误处理

### 常见错误

1. **Gist 不存在**
   - 错误消息：404: Gist 不存在或已被删除
   - 解决方案：检查 Gist ID 是否正确

2. **Gist 是私有的**
   - 错误消息：403: Gist 是私有的或您没有访问权限
   - 解决方案：确保 Gist 设置为公开

3. **网络连接失败**
   - 错误消息：Network: 网络连接失败
   - 解决方案：检查网络连接

4. **数据验证失败**
   - 错误消息：数据验证失败：[详细错误]
   - 解决方案：联系知识库拥有者修复数据

## 最佳实践

### 访客模式

1. **定期同步** - 定期点击同步按钮获取最新内容
2. **检查更新** - 如果内容看起来过时，尝试同步
3. **网络要求** - 确保网络连接正常

### 拥有者模式

1. **编辑前同步** - 编辑前先同步，避免冲突
2. **编辑后同步** - 编辑后及时同步，保存更改
3. **定期备份** - 定期导出数据作为备份

## 相关文档

- [Gist 设置指南](../user-guides/GIST_SETUP_GUIDE.md)
- [权限控制实现](../PERMISSION_CONTROL_IMPLEMENTATION.md)
- [错误处理指南](../development/ERROR_HANDLING.md)

## 更新历史

- 2025-11-20: 添加访客模式同步功能
- 2025-11-20: 改进错误处理和用户反馈
