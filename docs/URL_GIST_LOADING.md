# URL Gist 加载功能

## 功能概述

通过 URL 参数自动加载 GitHub Gist 数据，让访客可以通过分享链接直接查看知识库内容，无需手动导入。

## 使用方法

### 作为拥有者分享

1. 确保你已经在拥有者模式下配置了 GitHub Token
2. 点击页面上的"分享"按钮
3. 分享链接会自动复制到剪贴板
4. 将链接发送给其他人

分享链接格式：
```
https://yoursite.com/?gist=YOUR_GIST_ID
```

### 作为访客访问

1. 点击收到的分享链接
2. 系统会自动检测 URL 中的 `gist` 参数
3. 显示加载进度
4. 数据加载完成后自动显示内容

## 功能特性

### 自动加载
- 检测 URL 参数中的 Gist ID
- 自动从 GitHub 加载公开 Gist 数据
- 无需手动输入或导入

### 加载状态
- 显示清晰的加载进度
- 提供友好的错误提示
- 支持重试功能

### 数据冲突处理
- 如果本地已有数据，会显示确认对话框
- 对比本地和远程数据的统计信息
- 让用户选择使用哪份数据

### URL 清理
- 加载成功后自动清除 URL 参数
- 保持浏览器地址栏整洁
- 避免刷新时重复加载

## 错误处理

系统会处理以下错误情况：

1. **Gist 不存在**
   - 提示：Gist 不存在，请检查分享链接是否正确
   - 操作：提供重试选项

2. **Gist 是私有的**
   - 提示：无法访问私有 Gist，请确保 Gist 是公开的
   - 操作：提供重试选项

3. **网络错误**
   - 提示：网络错误，请检查网络连接后重试
   - 操作：提供重试选项

4. **数据格式错误**
   - 提示：数据格式不正确，请确保 Gist 包含有效的知识库数据
   - 操作：提供重试选项

## 数据冲突对话框

当访客通过 URL 加载数据时，如果本地已有数据，会显示数据冲突对话框：

### 显示内容
- 本地数据统计（资源、问题、子问题、回答数量）
- 远程数据统计（资源、问题、子问题、回答数量）
- 警告提示

### 操作选项
1. **使用分享的数据**：用远程数据覆盖本地数据
2. **保留本地数据**：保留当前本地数据，忽略远程数据
3. **取消**：关闭对话框，不做任何操作

## 技术实现

### 组件结构
- `useGistUrlLoader` Hook：处理 URL 参数和数据加载逻辑
- `GistLoadingModal`：显示加载状态和错误信息
- `GistDataConflictDialog`：处理数据冲突
- `UrlGistHandler`：集成组件，在应用启动时自动运行

### 数据流
1. 用户访问带有 `?gist=xxx` 参数的 URL
2. `useGistUrlLoader` 解析参数
3. 检查本地是否有数据
4. 从 GitHub 加载 Gist 数据（无需 token）
5. 验证数据格式
6. 如有冲突，显示确认对话框
7. 保存数据到本地缓存
8. 清除 URL 参数
9. 刷新页面显示数据

## 注意事项

1. **公开 Gist**：只能访问公开的 Gist，私有 Gist 需要 token
2. **数据覆盖**：选择使用远程数据会覆盖本地数据，请谨慎操作
3. **网络要求**：需要网络连接才能加载 Gist 数据
4. **浏览器兼容**：使用现代浏览器以获得最佳体验

## 示例

### 分享链接示例
```
https://yoursite.com/?gist=abc123def456789
```

### 测试步骤
1. 在拥有者模式下创建一些数据
2. 点击分享按钮获取链接
3. 在隐身窗口或其他浏览器中打开链接
4. 观察自动加载过程
5. 验证数据是否正确显示

## 相关文件

- `src/hooks/useGistUrlLoader.ts` - URL 加载 Hook
- `src/components/gist/GistLoadingModal.tsx` - 加载状态 Modal
- `src/components/gist/GistDataConflictDialog.tsx` - 数据冲突对话框
- `src/components/setup/UrlGistHandler.tsx` - URL 处理器组件
- `src/services/gistService.ts` - Gist API 服务
