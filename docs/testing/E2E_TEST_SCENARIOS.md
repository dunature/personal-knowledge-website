# 端到端测试场景

本文档记录 GitHub Gist 集成功能的端到端测试场景和测试步骤。

## 测试环境

- **浏览器**: Chrome, Firefox, Safari
- **网络**: 在线、离线模式
- **设备**: 桌面、平板、移动设备

## 测试场景

### 场景 1: 新用户首次配置流程

**目标**: 验证新用户可以成功配置 Token 并创建 Gist

**前置条件**:
- 清空浏览器 LocalStorage
- 准备有效的 GitHub Personal Access Token

**测试步骤**:

1. **访问应用**
   - [ ] 打开应用首页
   - [ ] 验证：自动显示配置向导
   - [ ] 验证：显示"拥有者模式"和"访客模式"选项

2. **选择拥有者模式**
   - [ ] 点击"拥有者模式"按钮
   - [ ] 验证：进入 Token 配置页面
   - [ ] 验证：显示 Token 获取指南

3. **配置 Token**
   - [ ] 输入有效的 GitHub Token
   - [ ] 点击"验证并保存"
   - [ ] 验证：显示验证中状态
   - [ ] 验证：验证成功后显示用户名
   - [ ] 验证：Token 被加密存储到 LocalStorage

4. **数据迁移（如果有本地数据）**
   - [ ] 如果检测到本地数据，显示迁移提示
   - [ ] 点击"迁移到 Gist"
   - [ ] 验证：显示迁移进度
   - [ ] 验证：迁移成功后保存 Gist ID
   - [ ] 验证：显示成功提示

5. **进入主应用**
   - [ ] 验证：配置向导关闭
   - [ ] 验证：显示主应用界面
   - [ ] 验证：顶部显示用户名和同步状态
   - [ ] 验证：可以正常使用所有功能

**预期结果**:
- Token 验证成功
- Gist 创建成功
- 数据迁移成功（如适用）
- 进入拥有者模式

**失败场景测试**:
- [ ] 输入无效 Token，验证错误提示
- [ ] 网络断开时配置，验证错误处理
- [ ] Token 权限不足，验证错误提示

---

### 场景 2: 拥有者模式完整功能测试

**目标**: 验证拥有者可以进行所有 CRUD 操作并自动同步

**前置条件**:
- 已配置有效 Token
- 已创建 Gist

**测试步骤**:

1. **创建资源**
   - [ ] 点击"添加资源"按钮
   - [ ] 填写资源信息（标题、URL、分类等）
   - [ ] 点击保存
   - [ ] 验证：资源显示在列表中
   - [ ] 验证：3秒后触发自动同步
   - [ ] 验证：同步状态指示器显示"同步中"
   - [ ] 验证：同步完成后显示"已同步"

2. **编辑资源**
   - [ ] 点击资源的编辑按钮
   - [ ] 修改资源信息
   - [ ] 保存修改
   - [ ] 验证：资源更新显示
   - [ ] 验证：触发自动同步

3. **删除资源**
   - [ ] 点击资源的删除按钮
   - [ ] 确认删除
   - [ ] 验证：资源从列表中移除
   - [ ] 验证：触发自动同步

4. **创建问答**
   - [ ] 点击"添加问题"按钮
   - [ ] 填写大问题、小问题、回答
   - [ ] 保存
   - [ ] 验证：问答显示在列表中
   - [ ] 验证：触发自动同步

5. **手动同步**
   - [ ] 点击同步指示器的手动同步按钮
   - [ ] 验证：立即触发同步
   - [ ] 验证：显示同步进度
   - [ ] 验证：同步完成后更新时间戳

6. **查看同步状态**
   - [ ] 验证：顶部显示同步状态（同步中/已同步/失败）
   - [ ] 验证：显示最后同步时间
   - [ ] 验证：显示当前用户名

**预期结果**:
- 所有 CRUD 操作成功
- 数据自动同步到 Gist
- 同步状态正确显示

---

### 场景 3: 访客模式查看功能测试

**目标**: 验证访客可以查看分享的知识库但不能编辑

**前置条件**:
- 拥有者已创建并分享 Gist
- 获取分享链接（包含 Gist ID）

**测试步骤**:

1. **通过分享链接访问**
   - [ ] 清空浏览器 LocalStorage
   - [ ] 访问分享链接（如 `?gist=abc123`）
   - [ ] 验证：自动切换到访客模式
   - [ ] 验证：自动加载 Gist 数据
   - [ ] 验证：显示"访客模式"标识

2. **查看内容**
   - [ ] 验证：可以查看所有资源
   - [ ] 验证：可以查看所有问答
   - [ ] 验证：可以使用搜索和筛选功能
   - [ ] 验证：可以查看资源详情

3. **验证编辑限制**
   - [ ] 验证：不显示"添加资源"按钮
   - [ ] 验证：不显示"添加问题"按钮
   - [ ] 验证：资源卡片不显示编辑/删除按钮
   - [ ] 验证：问题项不显示编辑/删除按钮
   - [ ] 验证：不显示同步指示器

4. **手动输入 Gist ID**
   - [ ] 清空浏览器 LocalStorage
   - [ ] 访问应用首页
   - [ ] 选择"访客模式"
   - [ ] 输入有效的 Gist ID
   - [ ] 点击"开始浏览"
   - [ ] 验证：成功加载数据
   - [ ] 验证：进入访客模式

5. **切换到拥有者模式**
   - [ ] 点击"切换到拥有者模式"按钮
   - [ ] 验证：显示 Token 配置页面
   - [ ] 配置 Token
   - [ ] 验证：成功切换到拥有者模式

**预期结果**:
- 可以查看所有内容
- 所有编辑功能被隐藏
- 可以切换到拥有者模式

**失败场景测试**:
- [ ] 输入无效 Gist ID，验证错误提示
- [ ] 访问私有 Gist（无权限），验证错误提示

---

### 场景 4: 跨设备数据同步测试

**目标**: 验证数据可以在多个设备间同步

**前置条件**:
- 准备两个设备（或两个浏览器）
- 使用相同的 GitHub 账号和 Token

**测试步骤**:

1. **设备 A - 创建数据**
   - [ ] 在设备 A 配置 Token
   - [ ] 创建一些资源和问答
   - [ ] 验证：数据同步到 Gist
   - [ ] 记录 Gist ID

2. **设备 B - 加载数据**
   - [ ] 在设备 B 配置相同的 Token
   - [ ] 验证：自动检测到已有 Gist
   - [ ] 验证：自动下载数据
   - [ ] 验证：显示设备 A 创建的数据

3. **设备 B - 修改数据**
   - [ ] 在设备 B 编辑一个资源
   - [ ] 验证：修改同步到 Gist

4. **设备 A - 刷新查看**
   - [ ] 在设备 A 刷新页面
   - [ ] 验证：自动从 Gist 加载最新数据
   - [ ] 验证：显示设备 B 的修改

5. **并发编辑测试**
   - [ ] 在设备 A 和 B 同时编辑不同的资源
   - [ ] 验证：两个设备的修改都成功同步
   - [ ] 刷新两个设备
   - [ ] 验证：两个设备显示相同的最新数据

**预期结果**:
- 数据在设备间成功同步
- 最后写入的数据优先
- 无数据丢失

---

### 场景 5: 分享功能测试

**目标**: 验证拥有者可以生成分享链接并分享给他人

**前置条件**:
- 拥有者已配置 Token
- 已创建一些数据

**测试步骤**:

1. **生成分享链接**
   - [ ] 在拥有者模式下，点击"分享"按钮
   - [ ] 验证：显示分享链接生成提示
   - [ ] 验证：链接自动复制到剪贴板
   - [ ] 验证：显示成功提示
   - [ ] 验证：链接格式正确（包含 gist 参数）

2. **测试分享链接**
   - [ ] 在新的隐身窗口打开分享链接
   - [ ] 验证：自动以访客模式加载数据
   - [ ] 验证：显示拥有者的知识库内容
   - [ ] 验证：不显示编辑功能

3. **分享给他人**
   - [ ] 将链接发送给另一个用户
   - [ ] 另一个用户打开链接
   - [ ] 验证：可以正常查看内容
   - [ ] 验证：以访客模式运行

**预期结果**:
- 分享链接生成成功
- 他人可以通过链接查看内容
- 访客无法编辑内容

---

### 场景 6: 离线支持测试

**目标**: 验证应用在离线状态下可以继续使用

**前置条件**:
- 已配置 Token
- 已同步一些数据

**测试步骤**:

1. **离线前准备**
   - [ ] 确保数据已同步
   - [ ] 记录当前数据状态

2. **断开网络**
   - [ ] 关闭网络连接（或使用浏览器离线模式）
   - [ ] 验证：应用继续运行
   - [ ] 验证：显示离线状态提示

3. **离线操作**
   - [ ] 创建新资源
   - [ ] 编辑现有资源
   - [ ] 删除资源
   - [ ] 验证：所有操作在本地成功
   - [ ] 验证：变更保存到待同步队列
   - [ ] 验证：同步状态显示"离线"或"待同步"

4. **恢复网络**
   - [ ] 重新连接网络
   - [ ] 验证：自动检测网络恢复
   - [ ] 验证：自动同步待同步变更
   - [ ] 验证：显示同步进度
   - [ ] 验证：同步完成后更新状态

5. **验证数据一致性**
   - [ ] 刷新页面
   - [ ] 验证：离线期间的所有变更都已同步
   - [ ] 在另一个设备查看
   - [ ] 验证：数据一致

**预期结果**:
- 离线时可以继续使用
- 变更保存到本地
- 网络恢复后自动同步
- 数据不丢失

---

### 场景 7: 版本历史和恢复测试

**目标**: 验证可以查看和恢复历史版本

**前置条件**:
- 已配置 Token
- 已进行多次数据修改（产生版本历史）

**测试步骤**:

1. **查看版本历史**
   - [ ] 进入设置页面
   - [ ] 点击"查看版本历史"
   - [ ] 验证：显示版本历史列表
   - [ ] 验证：每个版本显示时间戳
   - [ ] 验证：显示变更统计（添加/删除数量）

2. **预览历史版本**
   - [ ] 点击一个历史版本
   - [ ] 验证：显示该版本的数据统计
   - [ ] 验证：显示资源、问题数量
   - [ ] 验证：可以查看详细内容

3. **恢复历史版本**
   - [ ] 选择一个历史版本
   - [ ] 点击"恢复到此版本"
   - [ ] 验证：显示确认对话框
   - [ ] 确认恢复
   - [ ] 验证：显示恢复进度
   - [ ] 验证：恢复成功提示

4. **验证恢复结果**
   - [ ] 返回主页面
   - [ ] 验证：数据已恢复到选定版本
   - [ ] 验证：新的同步已触发
   - [ ] 刷新页面
   - [ ] 验证：数据保持一致

**预期结果**:
- 可以查看完整版本历史
- 可以预览历史版本内容
- 可以成功恢复到历史版本
- 恢复后数据正确

---

### 场景 8: 错误处理测试

**目标**: 验证各种错误情况的处理

**测试步骤**:

1. **Token 过期**
   - [ ] 在 GitHub 撤销 Token
   - [ ] 在应用中进行操作
   - [ ] 验证：显示"Token 已失效"错误
   - [ ] 验证：提示重新配置
   - [ ] 点击重新配置
   - [ ] 验证：进入 Token 配置页面

2. **网络错误**
   - [ ] 模拟网络不稳定（间歇性断开）
   - [ ] 进行数据操作
   - [ ] 验证：显示网络错误提示
   - [ ] 验证：自动重试
   - [ ] 验证：重试失败后加入待同步队列

3. **API 速率限制**
   - [ ] 短时间内进行大量操作（触发速率限制）
   - [ ] 验证：显示速率限制提示
   - [ ] 验证：显示等待时间
   - [ ] 验证：自动延迟重试

4. **数据格式错误**
   - [ ] 手动修改 Gist 数据为无效格式
   - [ ] 刷新应用
   - [ ] 验证：显示数据格式错误
   - [ ] 验证：使用本地缓存数据
   - [ ] 验证：提供恢复选项

5. **Gist 不存在**
   - [ ] 在访客模式输入不存在的 Gist ID
   - [ ] 验证：显示"Gist 不存在"错误
   - [ ] 验证：提示检查 ID 或联系分享者

**预期结果**:
- 所有错误都有友好的提示
- 提供恢复或重试选项
- 不会导致应用崩溃
- 数据不会丢失

---

## 测试检查清单

### 功能完整性
- [ ] 所有 CRUD 操作正常
- [ ] 自动同步功能正常
- [ ] 手动同步功能正常
- [ ] 离线支持正常
- [ ] 版本历史功能正常
- [ ] 分享功能正常
- [ ] 模式切换正常

### 用户体验
- [ ] 加载速度快（< 2秒）
- [ ] 操作响应及时
- [ ] 错误提示清晰
- [ ] 同步状态明确
- [ ] 界面友好直观

### 数据安全
- [ ] Token 加密存储
- [ ] 数据验证正确
- [ ] 无数据丢失
- [ ] 冲突处理正确

### 兼容性
- [ ] Chrome 浏览器正常
- [ ] Firefox 浏览器正常
- [ ] Safari 浏览器正常
- [ ] 移动端响应式正常

### 性能
- [ ] 大数据量（100+ 资源）加载正常
- [ ] 同步速度合理
- [ ] 内存使用正常
- [ ] 无明显卡顿

---

## 测试报告模板

### 测试信息
- **测试日期**: YYYY-MM-DD
- **测试人员**: [姓名]
- **测试环境**: [浏览器/设备]
- **应用版本**: [版本号]

### 测试结果
- **通过场景**: X/8
- **失败场景**: X/8
- **阻塞问题**: X 个
- **一般问题**: X 个

### 问题列表
1. **问题描述**: [详细描述]
   - **严重程度**: 高/中/低
   - **复现步骤**: [步骤]
   - **预期结果**: [描述]
   - **实际结果**: [描述]
   - **截图**: [如有]

### 总结
[测试总结和建议]

---

**最后更新**: 2024-01-20
