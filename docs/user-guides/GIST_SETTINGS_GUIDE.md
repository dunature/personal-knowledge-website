# Gist 设置页面使用指南

## 概述

在设置页面，你可以方便地管理你的 Gist 连接，包括：
- 输入和连接 Gist ID
- 查看当前 Gist 信息
- 生成分享链接
- 断开 Gist 连接
- 从 Gist 同步最新数据（访客模式和拥有者模式）

## 访问设置页面

1. 点击页面右上角的"设置"按钮
2. 或者直接访问 `/settings` 路径

## 功能说明

### 1. 连接 Gist（访客模式）

如果你在访客模式下，可以通过以下步骤连接到一个 Gist：

1. 在"Gist 数据管理"区域，你会看到"输入 Gist ID"的标题
2. 在输入框中输入 32 位的 Gist ID
3. 系统会实时验证格式（显示字符计数 0/32）
4. 点击"连接"按钮
5. 等待加载完成（会显示加载进度）
6. 连接成功后，页面会显示 Gist 信息

**提示**：
- Gist ID 必须是 20-40 位十六进制字符（支持新旧格式）
- 系统会自动去除首尾空格
- 支持大小写字母（自动转换为小写）
- 如果格式不正确，会显示详细的错误提示和修复建议
- 加载过程中会显示详细的进度信息
- 错误消息会区分格式错误、网络错误和验证错误

### 2. 连接 Gist（拥有者模式）

如果你在拥有者模式下（已输入 GitHub Token），可以：

1. 在"Gist 数据管理"区域，你会看到"创建或连接 Gist"的标题
2. 输入已有的 Gist ID，或者系统会自动为你创建新的 Gist
3. 如果本地有数据，系统会检测数据冲突
4. 选择处理方式：
   - **覆盖本地数据**：使用 Gist 中的数据替换本地数据
   - **保留本地数据并上传**：将本地数据上传到 Gist

**提示**：
- 拥有者模式下可以编辑和同步数据
- 系统会验证你对 Gist 的权限
- 如果没有权限，会显示错误提示

### 3. 查看 Gist 信息

连接 Gist 后，你可以看到：

- **Gist ID**：当前连接的 Gist 标识符
- **描述**：Gist 的描述信息
- **创建时间**：Gist 的创建日期
- **最后更新**：Gist 的最后更新时间
- **可见性**：公开或私有
- **所有者**：Gist 的所有者信息（用户名和头像）

你还可以：
- 点击"在 GitHub 查看"链接，在新标签页打开 Gist
- 点击"刷新"按钮，更新 Gist 信息

### 4. 生成分享链接

如果你想分享你的知识库给其他人：

1. 确保已连接 Gist
2. 在"操作"区域，点击"生成分享链接"按钮
3. 链接会自动复制到剪贴板
4. 显示成功提示："分享链接已复制到剪贴板"

**分享链接格式**：
```
https://your-domain.com/?gist=<gist_id>
```

**注意**：
- 分享链接会以访客模式打开
- 接收者只能查看数据，不能编辑
- 如果 Gist 是私有的，接收者需要有访问权限

### 5. 断开连接

如果你想断开当前的 Gist 连接：

1. 在"操作"区域，点击"断开连接"按钮
2. 系统会显示确认对话框
3. 阅读提示信息："确定要断开 Gist 连接吗？本地缓存数据将保留。"
4. 点击"确认断开"按钮
5. 等待操作完成
6. 页面会自动刷新，切换到访客模式

**重要提示**：
- 断开连接后，本地缓存的数据不会被删除
- 你可以随时重新连接到相同或不同的 Gist
- 断开连接后会自动切换到访客模式
- 如果你之前在拥有者模式，Token 会被保留（可以再次切换回拥有者模式）

### 6. 同步数据

#### 访客模式同步（只读）

如果你在访客模式下，可以从 Gist 拉取最新数据：

1. 在"Gist 数据管理"区域，找到"从 Gist 拉取数据"按钮
2. 点击按钮开始同步
3. 系统会显示同步进度（0% → 100%）
4. 同步完成后，页面会自动刷新显示最新数据

**特点**：
- 只能从 Gist 拉取数据（只读）
- 不能推送本地更改到 Gist
- 适合查看他人分享的知识库
- 可以随时获取最新内容

#### 拥有者模式同步（双向）

如果你在拥有者模式下，可以进行双向同步：

1. 在"Gist 数据管理"区域，找到"同步数据"按钮
2. 点击按钮开始同步
3. 系统会自动处理本地和云端的数据差异
4. 同步完成后显示结果

**特点**：
- 支持双向同步（拉取和推送）
- 自动处理数据冲突
- 保持本地和云端数据一致
- 需要 GitHub Token 认证

### 7. 更换 Gist ID（访客模式）

如果你在访客模式下已经连接了一个 Gist，想要切换到另一个：

1. 点击"更换 Gist ID"按钮
2. 输入新的 Gist ID
3. 点击"连接"按钮
4. 系统会加载新的 Gist 数据

## 常见问题

### Q: 为什么我输入的 Gist ID 无效？

A: Gist ID 必须满足以下条件：
- 长度为 20-40 个字符（支持新旧格式）
- 只包含十六进制字符（0-9, a-f, A-F）
- 系统会自动去除首尾空格
- 示例：
  - 旧格式（32位）：`abc123def456789012345678901234ab`
  - 新格式（20位）：`abc123def4567890abcd`

如果格式不正确，系统会显示详细的错误提示：
- **格式错误**：提供正确的格式说明和示例
- **网络错误**：检查网络连接
- **验证错误**：区分 404（不存在）、403（无权限）等具体错误

### Q: 连接 Gist 时显示"权限不足"怎么办？

A: 这可能是因为：
- 你在拥有者模式下，但 Token 没有足够的权限
- Gist 是私有的，你没有访问权限
- 解决方法：
  - 检查 Token 权限（需要 `gist` 权限）
  - 确认 Gist 是公开的，或者你有访问权限
  - 尝试切换到访客模式

### Q: 断开连接后，我的数据会丢失吗？

A: 不会。断开连接只是断开与 Gist 的同步关系，本地缓存的数据会被保留。你可以：
- 继续使用本地数据
- 重新连接到相同的 Gist
- 连接到不同的 Gist

### Q: 如何知道我当前连接的是哪个 Gist？

A: 在设置页面的"Gist 数据管理"区域，你可以看到：
- 当前 Gist ID
- Gist 的详细信息
- 所有者信息

### Q: 分享链接的有效期是多久？

A: 分享链接没有有效期限制，只要 Gist 存在且可访问，链接就一直有效。

### Q: 我可以同时连接多个 Gist 吗？

A: 不可以。一次只能连接一个 Gist。如果需要切换，请先断开当前连接，然后连接新的 Gist。

### Q: 访客模式下如何获取最新数据？

A: 访客模式下，你可以：
1. 进入设置页面
2. 点击"从 Gist 拉取数据"按钮
3. 等待同步完成
4. 页面会自动刷新显示最新内容

注意：访客模式只能拉取数据，不能推送更改。

## 最佳实践

### 1. 定期备份

虽然 Gist 提供了云端存储，但建议定期导出数据作为备份：
- 使用"数据导出"功能
- 保存 JSON 文件到本地

### 2. 使用有意义的 Gist 描述

在创建 Gist 时，使用清晰的描述，方便以后识别：
- 例如："我的个人知识库 - 2024"
- 避免使用默认描述

### 3. 管理访问权限

如果你的知识库包含敏感信息：
- 将 Gist 设置为私有
- 只分享给信任的人
- 定期检查访问权限

### 4. 保持同步

在拥有者模式下：
- 定期点击同步按钮
- 确保本地和云端数据一致
- 注意同步状态指示器

## 故障排除

### 连接失败

如果连接 Gist 失败，请检查：
1. 网络连接是否正常
2. Gist ID 是否正确
3. Gist 是否存在
4. 是否有访问权限

### 加载缓慢

如果加载 Gist 数据很慢：
1. 检查网络速度
2. 等待加载完成（不要刷新页面）
3. 如果超过 30 秒，可以尝试刷新页面

### 数据不同步

如果发现数据不同步：
1. 检查同步状态指示器
2. 手动点击同步按钮
3. 检查是否有冲突需要解决

## 相关文档

- [Gist 快速开始指南](../GIST_QUICK_START.md)
- [Gist 设置指南](./GIST_SETUP_GUIDE.md)
- [访客模式同步功能](../features/VISITOR_MODE_SYNC.md)
- [简化登录流程](./SIMPLIFIED_LOGIN.md)
- [数据存储 FAQ](../DATA_STORAGE_FAQ.md)

## 技术支持

如果遇到问题，请：
1. 查看[故障排除文档](../troubleshooting/)
2. 检查浏览器控制台的错误信息
3. 提交 Issue 到 GitHub 仓库

---

**最后更新**: 2025-11-20  
**版本**: 1.1.0
