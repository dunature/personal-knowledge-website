# GitHub Gist 配置指南

本指南将帮助你配置 GitHub Gist 数据持久化功能，实现跨设备数据同步和内容分享。

## 目录

- [什么是 GitHub Gist？](#什么是-github-gist)
- [使用模式](#使用模式)
- [拥有者模式配置](#拥有者模式配置)
- [访客模式使用](#访客模式使用)
- [数据迁移](#数据迁移)
- [分享功能](#分享功能)
- [常见问题](#常见问题)

## 什么是 GitHub Gist？

GitHub Gist 是 GitHub 提供的代码片段存储服务，我们使用它来：
- 安全地存储你的知识库数据
- 实现跨设备数据同步
- 支持版本历史和数据恢复
- 分享你的知识库给他人查看

## 使用模式

应用支持两种使用模式：

### 拥有者模式 👤
- 需要配置 GitHub Personal Access Token
- 可以创建、编辑、删除数据
- 数据自动同步到你的 GitHub Gist
- 可以生成分享链接给他人查看

### 访客模式 👁️
- 无需配置 Token
- 只能查看他人分享的知识库
- 所有编辑按钮将被隐藏
- 适合浏览和学习他人的内容

## 拥有者模式配置

### 步骤 1: 创建 GitHub Personal Access Token

1. **登录 GitHub**
   - 访问 [github.com](https://github.com) 并登录你的账号

2. **进入 Token 设置页面**
   - 点击右上角头像 → Settings
   - 左侧菜单选择 Developer settings
   - 选择 Personal access tokens → Tokens (classic)
   - 点击 "Generate new token" → "Generate new token (classic)"

3. **配置 Token**
   - **Note**: 输入描述，如 "Personal Knowledge Website"
   - **Expiration**: 选择过期时间（建议选择 "No expiration" 或较长时间）
   - **Select scopes**: 勾选 `gist` 权限（这是唯一需要的权限）

4. **生成并复制 Token**
   - 点击页面底部的 "Generate token"
   - **重要**: 立即复制生成的 Token（格式如 `ghp_xxxxxxxxxxxx`）
   - Token 只会显示一次，请妥善保存

### 步骤 2: 在应用中配置 Token

1. **首次访问**
   - 打开应用，会自动显示配置向导
   - 选择 "拥有者模式"

2. **输入 Token**
   - 将复制的 Token 粘贴到输入框
   - 点击 "验证并保存"

3. **验证成功**
   - 应用会验证 Token 的有效性
   - 验证成功后会显示你的 GitHub 用户名
   - Token 会被加密存储在本地

### 步骤 3: 数据迁移（如果有本地数据）

如果你之前已经在本地创建了数据，应用会提示你迁移：

1. **检测本地数据**
   - 应用会显示本地数据统计（资源数量、问题数量等）

2. **选择迁移**
   - 点击 "迁移到 Gist" 按钮
   - 应用会创建新的 Gist 并上传所有数据

3. **迁移完成**
   - 迁移成功后，Gist ID 会被保存
   - 之后的所有变更都会自动同步

## 访客模式使用

### 通过分享链接访问

1. **点击分享链接**
   - 拥有者分享的链接格式：`https://your-app.com?gist=xxxxx`
   - 点击链接会自动加载该知识库

2. **手动输入 Gist ID**
   - 在配置向导选择 "访客模式"
   - 输入 Gist ID（如 `abc123def456`）
   - 点击 "开始浏览"

3. **浏览内容**
   - 可以查看所有资源和问答
   - 所有编辑功能将被隐藏
   - 顶部会显示 "访客模式" 标识

### 切换到拥有者模式

如果你想管理自己的知识库：
1. 点击顶部的 "切换到拥有者模式" 按钮
2. 按照拥有者模式配置步骤操作

## 数据迁移

### 从本地迁移到 Gist

**自动迁移**（推荐）
- 首次配置 Token 时，应用会自动检测本地数据
- 按照提示点击 "迁移到 Gist" 即可

**手动迁移**
1. 进入设置页面
2. 找到 "数据管理" 区域
3. 点击 "同步到 Gist"

### 从 Gist 恢复到新设备

1. **在新设备配置 Token**
   - 使用相同的 GitHub 账号创建 Token
   - 在新设备输入 Token

2. **自动加载数据**
   - 应用会检测到你已有的 Gist
   - 自动下载并恢复所有数据

3. **验证数据**
   - 检查资源和问答是否完整
   - 开始在新设备上使用

## 分享功能

### 生成分享链接

1. **确保在拥有者模式**
   - 只有拥有者可以生成分享链接

2. **点击分享按钮**
   - 在顶部工具栏找到 "分享" 按钮
   - 点击后会自动生成分享链接

3. **复制链接**
   - 链接会自动复制到剪贴板
   - 格式：`https://your-app.com?gist=your_gist_id`

4. **分享给他人**
   - 通过邮件、社交媒体等方式分享链接
   - 他人点击链接即可以访客模式查看你的知识库

### 分享注意事项

⚠️ **隐私提醒**：
- 分享的 Gist 是公开的，任何人都可以通过链接访问
- 不要在知识库中存储敏感信息（密码、私钥等）
- 如需私密存储，请使用本地模式

## 常见问题

### Q: Token 安全吗？

**A**: 是的，Token 采用多重安全措施：
- 使用 Web Crypto API 加密存储在本地
- 不会在日志或错误消息中暴露
- 所有 API 通信使用 HTTPS
- 你可以随时在 GitHub 撤销 Token

### Q: 数据会自动同步吗？

**A**: 是的，在拥有者模式下：
- 每次数据变更后 3 秒自动同步
- 使用防抖机制避免频繁 API 调用
- 离线时变更会保存到本地，网络恢复后自动同步

### Q: 如何查看同步状态？

**A**: 在拥有者模式下：
- 顶部工具栏显示同步状态指示器
- 状态包括：同步中、已同步、同步失败
- 显示最后同步时间
- 可以点击手动触发同步

### Q: Token 过期了怎么办？

**A**: 如果 Token 过期或失效：
1. 应用会显示 "Token 已失效" 提示
2. 进入设置页面
3. 点击 "更新 Token"
4. 在 GitHub 创建新的 Token 并输入

### Q: 可以恢复历史版本吗？

**A**: 是的，Gist 支持版本历史：
1. 进入设置页面
2. 点击 "查看版本历史"
3. 选择要恢复的版本
4. 点击 "恢复到此版本"

### Q: 如何导出数据备份？

**A**: 在设置页面：
1. 找到 "数据管理" 区域
2. 点击 "导出数据"
3. 会下载包含所有数据的 JSON 文件
4. 妥善保存备份文件

### Q: 如何导入数据？

**A**: 在设置页面：
1. 找到 "数据管理" 区域
2. 点击 "导入数据"
3. 选择之前导出的 JSON 文件
4. 确认导入操作

### Q: 离线时可以使用吗？

**A**: 可以：
- 应用会使用本地缓存的数据
- 可以继续创建、编辑、删除数据
- 所有变更会保存到本地
- 网络恢复后自动同步到 Gist

### Q: 如何清除所有数据？

**A**: 在设置页面：
1. 找到 "数据管理" 区域
2. 点击 "清除所有数据"
3. 确认操作
4. 会清除 Token、缓存和所有本地数据

### Q: API 调用有限制吗？

**A**: GitHub API 有速率限制：
- 已认证用户：5000 次/小时
- 应用使用防抖和缓存机制减少 API 调用
- 如果达到限制，应用会显示等待时间

### Q: 可以在多个设备同时使用吗？

**A**: 可以，但需注意：
- 在每个设备配置相同的 Token
- 数据会自动同步
- 使用 "最后写入优先" 策略处理冲突
- 建议在一个设备完成编辑后再切换到另一个设备

## 获取帮助

如果遇到问题：
1. 查看应用内的错误提示
2. 检查网络连接
3. 验证 Token 是否有效
4. 查看浏览器控制台的错误日志
5. 访问项目 GitHub 仓库提交 Issue

---

**祝你使用愉快！** 🎉
