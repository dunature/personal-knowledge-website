<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilibili API æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #666;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        button {
            background: #00a1d6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        button:hover {
            background: #0090c0;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
        }

        .success {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }

        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }

        .info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }

        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }

        .video-list {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .video-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .video-item:hover {
            background: #e3f2fd;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ¬ Bilibili API æµ‹è¯•å·¥å…·</h1>

        <div class="input-group">
            <label>Bilibili è§†é¢‘ URL æˆ– BV å·</label>
            <input type="text" id="videoUrl" placeholder="https://www.bilibili.com/video/BV1uv411q7Mv æˆ– BV1uv411q7Mv"
                value="BV1uv411q7Mv">
        </div>

        <button onclick="testVideo()" id="testBtn">æµ‹è¯•è§†é¢‘</button>

        <div id="result"></div>

        <div class="video-list">
            <h3>ğŸ“‹ æ¨èæµ‹è¯•è§†é¢‘</h3>
            <div class="video-item" onclick="setVideo('BV1uv411q7Mv')">
                <strong>BV1uv411q7Mv</strong> - å“”å“©å“”å“©å®˜æ–¹è§†é¢‘
            </div>
            <div class="video-item" onclick="setVideo('BV1xx411c7mD')">
                <strong>BV1xx411c7mD</strong> - ç»å…¸éŸ³ä¹è§†é¢‘
            </div>
            <div class="video-item" onclick="setVideo('BV1GJ411x7h7')">
                <strong>BV1GJ411x7h7</strong> - æ—§è§†é¢‘ï¼ˆå¯èƒ½å¤±æ•ˆï¼‰
            </div>
        </div>

        <div class="result info" style="margin-top: 20px;">
            <strong>ğŸ’¡ è¯´æ˜:</strong>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>æ­¤å·¥å…·ç›´æ¥è°ƒç”¨ Bilibili APIï¼ˆå¯èƒ½é‡åˆ° CORS é—®é¢˜ï¼‰</li>
                <li>å¦‚æœçœ‹åˆ° CORS é”™è¯¯ï¼Œè¯´æ˜éœ€è¦ä½¿ç”¨ä»£ç†</li>
                <li>-404 é”™è¯¯è¡¨ç¤ºè§†é¢‘ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤</li>
                <li>å»ºè®®ä½¿ç”¨å¼€å‘æœåŠ¡å™¨çš„æµ‹è¯•é¡µé¢ï¼ˆå·²é…ç½®ä»£ç†ï¼‰</li>
            </ul>
        </div>
    </div>

    <script>
        function setVideo(bvid) {
            document.getElementById('videoUrl').value = bvid;
        }

        async function testVideo() {
            const input = document.getElementById('videoUrl').value.trim();
            const resultDiv = document.getElementById('result');
            const testBtn = document.getElementById('testBtn');

            if (!input) {
                resultDiv.innerHTML = '<div class="result error">è¯·è¾“å…¥è§†é¢‘ URL æˆ– BV å·</div>';
                return;
            }

            // æå– BV å·
            const bvMatch = input.match(/(?:bilibili\.com\/video\/)?(BV[a-zA-Z0-9]+)/);
            if (!bvMatch || !bvMatch[1]) {
                resultDiv.innerHTML = '<div class="result error">æ— æ³•æå– BV å·ï¼Œè¯·æ£€æŸ¥è¾“å…¥</div>';
                return;
            }

            const bvid = bvMatch[1];
            testBtn.disabled = true;
            testBtn.textContent = 'æµ‹è¯•ä¸­...';

            resultDiv.innerHTML = '<div class="result info">æ­£åœ¨è¯·æ±‚ Bilibili API...</div>';

            try {
                const apiUrl = `https://api.bilibili.com/x/web-interface/view?bvid=${bvid}`;
                console.log('API URL:', apiUrl);

                const response = await fetch(apiUrl);
                const data = await response.json();

                console.log('API å“åº”:', data);

                if (data.code === 0 && data.data) {
                    // æˆåŠŸ
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>âœ… æˆåŠŸè·å–è§†é¢‘ä¿¡æ¯</h3>
                            <p><strong>æ ‡é¢˜:</strong> ${data.data.title}</p>
                            <p><strong>UPä¸»:</strong> ${data.data.owner?.name || 'æœªçŸ¥'}</p>
                            <p><strong>BVå·:</strong> ${bvid}</p>
                            <p><strong>å°é¢:</strong></p>
                            <img src="${data.data.pic}" alt="å°é¢" style="max-width: 100%; border-radius: 4px; margin-top: 10px;">
                            <details style="margin-top: 10px;">
                                <summary style="cursor: pointer;">æŸ¥çœ‹å®Œæ•´å“åº”</summary>
                                <pre>${JSON.stringify(data, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    // API è¿”å›é”™è¯¯
                    let errorMsg = '';
                    if (data.code === -404) {
                        errorMsg = 'è§†é¢‘ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤';
                    } else if (data.code === -403) {
                        errorMsg = 'æƒé™ä¸è¶³ï¼Œè§†é¢‘å¯èƒ½éœ€è¦ç™»å½•æˆ–å·²è¢«é™åˆ¶';
                    } else {
                        errorMsg = data.message || 'æœªçŸ¥é”™è¯¯';
                    }

                    resultDiv.innerHTML = `
                        <div class="result error">
                            <h3>âŒ API è¿”å›é”™è¯¯</h3>
                            <p><strong>é”™è¯¯ç :</strong> ${data.code}</p>
                            <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${errorMsg}</p>
                            <p><strong>å»ºè®®:</strong> å°è¯•ä½¿ç”¨å…¶ä»–è§†é¢‘çš„ BV å·</p>
                            <details style="margin-top: 10px;">
                                <summary style="cursor: pointer;">æŸ¥çœ‹å®Œæ•´å“åº”</summary>
                                <pre>${JSON.stringify(data, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('è¯·æ±‚å¤±è´¥:', error);

                let errorMsg = error.message;
                let isCORS = errorMsg.includes('CORS') || errorMsg.includes('fetch');

                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>âŒ è¯·æ±‚å¤±è´¥</h3>
                        <p><strong>é”™è¯¯:</strong> ${errorMsg}</p>
                        ${isCORS ? `
                            <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 4px;">
                                <strong>âš ï¸ CORS é”™è¯¯</strong>
                                <p style="margin: 5px 0;">æµè§ˆå™¨é˜»æ­¢äº†è·¨åŸŸè¯·æ±‚ã€‚è¿™æ˜¯æ­£å¸¸çš„ï¼</p>
                                <p style="margin: 5px 0;"><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
                                <ul style="margin: 5px 0; padding-left: 20px;">
                                    <li>ä½¿ç”¨å¼€å‘æœåŠ¡å™¨çš„æµ‹è¯•é¡µé¢ï¼ˆå·²é…ç½®ä»£ç†ï¼‰</li>
                                    <li>è®¿é—®: <code>http://localhost:5173/platform-autofill-test</code></li>
                                </ul>
                            </div>
                        ` : ''}
                        <pre style="margin-top: 10px;">${error.stack || error}</pre>
                    </div>
                `;
            } finally {
                testBtn.disabled = false;
                testBtn.textContent = 'æµ‹è¯•è§†é¢‘';
            }
        }

        // æ”¯æŒå›è½¦é”®
        document.getElementById('videoUrl').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                testVideo();
            }
        });
    </script>
</body>

</html>